---\rtitle: PySide2嵌入HTML使用Flask响应\rcreateTime: 2021/10/15 00:00:00\rtags:\r  - 前后端\rpermalink: /article/gvahiniq/\r---\r\r## project 结构\r\r::: file-tree\r- root\r  - dist\r    - css\r    - fonts\r    - img\r    - js\r      - favicon.ico\r      - index.html\r  - pyside_flask_desk\r    - \_\_init\_\_.py\r  - app.py\r  - run_test.py\r:::\r\r1. **dist**: 文件夹为前端内容, 其中包括前端的html, css, js等内容\r2. **pyside_flask_desk**: 文件夹内 `\_\_init\_\_.py` 文件为创建Qt窗口, 并使用线程启动flask\r3. **run_test.py**: 为程序主入口\r\r\r## 程序主入口 run_test.py\r\r```python\r#! -*- coding:utf-8 -*-\rimport sys\rimport os\rfrom app import *\rfrom PySide2.QtCore import QFileInfo\rfrom pyside_flask_desk import init_gui\r\rsys.path.append((os.path.dirname(os.path.abspath(os.path.dirname(__file__)))).replace("\\", "/"))\r\r\rif __name__ == '__main__':\r    root = QFileInfo(__file__).absolutePath()\r    init_gui(app, port=5000, window_title="钓鱼城", icon=root + "/dist/favicon.ico")\r\r\r```\r\r::: warning \r其中icon的路径必须使用**绝对路径**, 相对路径无法加载\r:::\r\r\r## init_gui 函数创建Qt主窗口, 线程启动flask\r\r```python\rimport sys\rfrom PySide2 import QtCore, QtWidgets, QtGui, QtWebEngineWidgets\rimport socket\r\r\rclass ApplicationThread(QtCore.QThread):\r    def __init__(self, application, port=5000):\r        super(ApplicationThread, self).__init__()\r        self.application = application\r        self.port = port\r\r    def __del__(self):\r        self.wait()\r\r    def run(self):\r        # flask app.run()\r        self.application.run(port=self.port, threaded=True)\r\r\rclass WebPage(QtWebEngineWidgets.QWebEnginePage):\r    def __init__(self, root_url):\r        super(WebPage, self).__init__()\r        self.root_url = root_url\r\r    def home(self):\r        self.load(QtCore.QUrl(self.root_url))\r\r        \rdef init_gui(application, icon, port, width=800, height=600,\r             window_title="PyFladesk", argv=None):\r    if argv is None:\r        argv = sys.argv\r\r    # 创建主窗口框架\r    qtapp = QtWidgets.QApplication(argv)\r    \r    # 线程启动flask\r    webapp = ApplicationThread(application, port)\r    webapp.start()\r    # connect function:关闭qtapp窗口时, 调用flask的终止\r    qtapp.aboutToQuit.connect(webapp.terminate) \r\r    # 创建主窗口, 并设置大小, 标题, icon\r    window = QtWidgets.QMainWindow()\r    window.resize(width, height)\r    window.setWindowTitle(window_title)\r    window.setWindowIcon(QtGui.QIcon(icon))\r\r    # 创建WebEngineView并套入主窗口\r    webView = QtWebEngineWidgets.QWebEngineView(window)\r    window.setCentralWidget(webView)\r\r    # 通过home()加载url,并将page放入view\r    page = WebPage('http://localhost:{}'.format(port))\r    page.home()\r    webView.setPage(page)\r	\r    # 显示窗口\r    window.show()\r    return qtapp.exec_()\r\r```\r\r## app.py flask后端响应\r\r```python\rfrom flask import Flask,  render_template\r\rapp = Flask(__name__, static_url_path='', static_folder='dist', template_folder='dist')\r\r\rapp.config['EXPLAIN_TEMPLATE_LOADING'] = True\r\r# 路由\r@app.route('/')\rdef greet():\r    return render_template('index.html')\r\r\r```\r::: warning\r其中`static_url_path=''`不可缺少, 是由于前端html中将资源加载的目录写死为根目录. \r\r`static_folder='dist', template_folder='dist'`根据具体project的实际情况写html, css等文件在的文件夹即可. \r该文件为flask接口主文件, 接口开发写法跟之前通用版本相同. \r:::\r\r## 最终效果:\r\r![钓鱼城系统Qt版本首页](/screen_shot/fishing-castle-qt-homepage.png)\r\r\r