---
title: Redis
icon: /logo/Redis.png
createTime: 2024/09/25 15:54:57
permalink: /interview/uqcg8do8/
---
::: tip 提问
1. Redis有哪些常见的类型?
2. Redis对于已过期的数据如何淘汰?
3. 如何保证与MySQL之间的一致性?
4. 为什么先操作数据库?
5. 应该更新缓存还是删除缓存?
:::

## 常见的数据类型
1. String
2. Set: 集合
3. Zset: 有序集合
4. List
5. Hash: dict

## Set和Zset之间的区别:
Zset是有序的, 额外提供了一个double类型的评分进行排序. 评分可以重复, 但是元素不能重复.

## Zset和List之间的区别:
List的元素可以重复, 实现上使用的是双向链表.

Zset保证元素之间的唯一性, 实现上使用的是哈希表.

## 淘汰机制
详情见[Redis详解](/article/jbhd1al8/#淘汰机制)


## 缓存一致性
### 延迟双删

#### 读操作
缓存命中, 直接返回；缓存没有命中则查询数据库, 写入缓存, 设定超时时间

#### 写操作
1. 先删除缓存
2. 再更新数据库
3. 休眠一会(比如1秒), 再次删除缓存

### 为什么先操作数据库?
假设进行以下的操作
::: steps
1. 线程A发起一个写操作，第一步del cache
   
2. 此时线程B发起一个读操作，cache miss
   
3. 线程B继续读DB，读出来一个老数据
   
4. 然后线程B把老数据设置入cache
   
5. 线程A写入DB最新的数据
:::
此时数据库是新数据, redis是老数据, 不一致了. 

### 到底是删除缓存呢，还是更新缓存?
==更新数据库==
假设以下操作:
::: steps
1. 线程A先发起一个写操作，第一步先更新数据库
   
2. 线程B再发起一个写操作，第二步更新了数据库
   
3. 由于网络等原因，线程B先更新了缓存

4. 线程A更新缓存
:::